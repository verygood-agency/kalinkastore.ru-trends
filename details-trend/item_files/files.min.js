var CallibriFiles=function(a){this.init(a)};CallibriFiles.prototype={init:function(a){var b=this;if(b.options=a,b.options.animation_dnd_speed=600,b.svg={table:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 82.71 114.32"><defs></defs><g id="Слой_2" data-name="Слой 2"><g id="Слой_1-2" data-name="Слой 1"><path d="M60 8.36H7.51A5.51 5.51 0 0 0 2 13.87v92.94a5.51 5.51 0 0 0 5.51 5.51H75.2a5.5 5.5 0 0 0 5.51-5.51V29.12z" class="callibriFilesFill"/><path class="callibriFilesBg" d="M75.2 114.32H7.51A7.52 7.52 0 0 1 0 106.81V13.87a7.52 7.52 0 0 1 7.51-7.51h53.28l21.92 21.93v78.52a7.52 7.52 0 0 1-7.51 7.51zM7.51 10.36A3.52 3.52 0 0 0 4 13.87v92.94a3.51 3.51 0 0 0 3.51 3.51H75.2a3.51 3.51 0 0 0 3.51-3.51V30L59.13 10.36z"/><path fill="#fff" d="M59.96 8.36v21.41h20.75L59.96 8.36z"/><path class="callibriFilesBg" d="M80.71 31.77H60a2 2 0 0 1-2-2V8.36A2 2 0 0 1 61.39 7l20.76 21.4a2 2 0 0 1-1.44 3.4zm-18.71-4h14L62 13.3zM21.72 48.06h-6.66a7.16 7.16 0 0 1-7.15-7.15V8.36A8.37 8.37 0 0 1 16.27 0H23a8.37 8.37 0 0 1 8.36 8.36 2 2 0 0 1-4 0A4.36 4.36 0 0 0 23 4h-6.73a4.37 4.37 0 0 0-4.36 4.36v32.55a3.16 3.16 0 0 0 3.15 3.15h6.66a3.15 3.15 0 0 0 3.15-3.15V22.12a3.16 3.16 0 1 0-6.31 0v14.8a2 2 0 0 1-4 0v-14.8a7.16 7.16 0 1 1 14.31 0v18.79a7.16 7.16 0 0 1-7.15 7.15zM56.48 53.71H8.36V104h66V53.71zm-3.1 3.1v8.54h-24v-8.54zm-24 32.26v-8.76h24v8.76zm24 3.1v8.76h-24v-8.76zM26.26 80.31v8.76h-14.8v-8.76zm-14.8-3.1v-8.76h14.8v8.76zm17.9 0v-8.76h24v8.76zm-3.1-20.4v8.54h-14.8v-8.54zm-14.8 35.36h14.8v8.76h-14.8zm59.75 8.76H56.48v-8.76h14.73zm0-11.86H56.48v-8.76h14.73zm0-11.86H56.48v-8.76h14.73zm0-11.86H56.48v-8.54h14.73z"/></g></g></svg>',presentation:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 82.71 114.32"><defs></defs><g id="Слой_2" data-name="Слой 2"><g id="Слой_1-2" data-name="Слой 1"><path d="M60 8.36H7.51A5.51 5.51 0 0 0 2 13.87v92.94a5.51 5.51 0 0 0 5.51 5.51H75.2a5.5 5.5 0 0 0 5.51-5.51V29.12z" class="callibriFilesFill"/><path class="callibriFilesBg" d="M75.2 114.32H7.51A7.52 7.52 0 0 1 0 106.81V13.87a7.52 7.52 0 0 1 7.51-7.51h53.27l21.93 21.93v78.52a7.52 7.52 0 0 1-7.51 7.51zM7.51 10.36A3.52 3.52 0 0 0 4 13.87v92.94a3.51 3.51 0 0 0 3.51 3.51H75.2a3.51 3.51 0 0 0 3.51-3.51V30L59.13 10.36z"/><path fill="#fff" d="M59.96 8.36v21.41h20.75L59.96 8.36z"/><path class="callibriFilesBg" d="M80.71 31.77H60a2 2 0 0 1-2-2V8.36A2 2 0 0 1 61.39 7l20.76 21.4a2 2 0 0 1-1.44 3.4zm-18.71-4h14L62 13.3zM21.71 48.06h-6.65a7.16 7.16 0 0 1-7.15-7.15V8.36A8.37 8.37 0 0 1 16.27 0H23a8.37 8.37 0 0 1 8.36 8.36 2 2 0 0 1-4 0A4.36 4.36 0 0 0 23 4h-6.73a4.37 4.37 0 0 0-4.36 4.36v32.55a3.16 3.16 0 0 0 3.15 3.15h6.65a3.16 3.16 0 0 0 3.16-3.15V22.12a3.16 3.16 0 1 0-6.31 0v14.8a2 2 0 0 1-4 0v-14.8a7.16 7.16 0 1 1 14.31 0v18.79a7.16 7.16 0 0 1-7.16 7.15zM64.36 85.3H16.65a4.25 4.25 0 0 1-4.25-4.24V55.63a4.25 4.25 0 0 1 4.25-4.25h47.71a4.25 4.25 0 0 1 4.25 4.25v25.43a4.25 4.25 0 0 1-4.25 4.24zM16.65 54.38a1.25 1.25 0 0 0-1.25 1.25v25.43a1.24 1.24 0 0 0 1.25 1.24h47.71a1.24 1.24 0 0 0 1.25-1.24V55.63a1.25 1.25 0 0 0-1.25-1.25zM23.92 101.6a1.5 1.5 0 0 1-1.1-.48 1.53 1.53 0 0 1 .09-2.12c.5-.48 11.26-8 17.63-12.45a1.49 1.49 0 0 1 1.72 0l17.38 12.23a1.5 1.5 0 0 1-1.73 2.46L41.39 89.6c-6.58 4.59-15.82 11.07-16.47 11.6a1.43 1.43 0 0 1-1 .4z"/><path class="callibriFilesBg" d="M40.05 59.2H21.76a2.11 2.11 0 0 0-2.12 2.12 2.12 2.12 0 0 0 2.12 2.12h18.29a2.12 2.12 0 0 0 2.12-2.12 2.13 2.13 0 0 0-2.12-2.12zM60.05 68.85H21a1.31 1.31 0 0 1-1.31-1.31 1.31 1.31 0 0 1 1.31-1.3h39.1a1.3 1.3 0 0 1 1.31 1.3 1.3 1.3 0 0 1-1.31 1.31zM60.05 72.93H21a1.32 1.32 0 0 1-1.31-1.31A1.31 1.31 0 0 1 21 70.31h39.1a1.33 1.33 0 0 1 .93.38 1.31 1.31 0 0 1 .38.93 1.31 1.31 0 0 1-1.31 1.31zM53.74 76.91H21a1.31 1.31 0 0 1-1.31-1.31A1.31 1.31 0 0 1 21 74.29h32.74a1.35 1.35 0 0 1 .93.38 1.31 1.31 0 0 1 .38.93 1.31 1.31 0 0 1-1.31 1.31z"/></g></g></svg>',image:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 82.71 114.32"><defs></defs><g id="Слой_2" data-name="Слой 2"><g id="Слой_1-2" data-name="Слой 1"><path d="M60 8.36H7.51A5.51 5.51 0 0 0 2 13.87v92.94a5.51 5.51 0 0 0 5.51 5.51H75.2a5.5 5.5 0 0 0 5.51-5.51V29.12z" class="callibriFilesFill"/><path class="callibriFilesBg" d="M75.2 114.32H7.51A7.52 7.52 0 0 1 0 106.81V13.87a7.52 7.52 0 0 1 7.51-7.51h53.28l21.92 21.93v78.52a7.52 7.52 0 0 1-7.51 7.51zM7.51 10.36A3.52 3.52 0 0 0 4 13.87v92.94a3.51 3.51 0 0 0 3.51 3.51H75.2a3.51 3.51 0 0 0 3.51-3.51V30L59.13 10.36z"/><path fill="#fff" d="M59.96 8.36v21.41h20.75L59.96 8.36z"/><path class="callibriFilesBg" d="M80.71 31.77H60a2 2 0 0 1-2-2V8.36A2 2 0 0 1 61.39 7l20.76 21.4a2 2 0 0 1-1.44 3.4zm-18.71-4h14L62 13.3zM21.71 48.06h-6.65a7.16 7.16 0 0 1-7.15-7.15V8.36A8.37 8.37 0 0 1 16.27 0H23a8.37 8.37 0 0 1 8.36 8.36 2 2 0 0 1-4 0A4.36 4.36 0 0 0 23 4h-6.73a4.37 4.37 0 0 0-4.36 4.36v32.55a3.16 3.16 0 0 0 3.15 3.15h6.65a3.15 3.15 0 0 0 3.16-3.15V22.12a3.16 3.16 0 1 0-6.31 0v14.8a2 2 0 0 1-4 0v-14.8a7.16 7.16 0 1 1 14.31 0v18.79a7.16 7.16 0 0 1-7.16 7.15zM65.71 97.66H16.92a6.13 6.13 0 0 1-6.13-6.12V59.89a6.14 6.14 0 0 1 6.13-6.13h48.79a6.13 6.13 0 0 1 6.12 6.13v31.65a6.12 6.12 0 0 1-6.12 6.12zm-48.79-40.9a3.14 3.14 0 0 0-3.13 3.13v31.65a3.13 3.13 0 0 0 3.13 3.12h48.79a3.12 3.12 0 0 0 3.12-3.12V59.89a3.13 3.13 0 0 0-3.12-3.13z"/><path class="callibriFilesBg" d="M63.73 92.73H18.9a3.44 3.44 0 0 1-3.43-3.43V62.13a3.44 3.44 0 0 1 3.43-3.43h44.83a3.44 3.44 0 0 1 3.43 3.43V89.3a3.44 3.44 0 0 1-3.43 3.43zM18.9 59.7a2.43 2.43 0 0 0-2.43 2.43V89.3a2.43 2.43 0 0 0 2.43 2.43h44.83a2.43 2.43 0 0 0 2.43-2.43V62.13a2.43 2.43 0 0 0-2.43-2.43z"/><path class="callibriFilesBg" d="M17.54 91.33a1 1 0 0 1-.72-.31 1 1 0 0 1 0-1.41L31.94 75a1 1 0 0 1 1.25-.11l5.31 3.59 8.65-10.76a1 1 0 0 1 .78-.37 1 1 0 0 1 .78.39l4 5.2 3.51-1a1 1 0 0 1 1.12.45l9.53 15.73a1 1 0 1 1-1.71 1L56 74.09l-3.4.91a1 1 0 0 1-1.06-.35L47.91 70l-8.43 10.44a1 1 0 0 1-1.34.2L32.75 77 18.24 91a1 1 0 0 1-.7.33zM25.68 73.86a5.52 5.52 0 1 1 5.52-5.52 5.53 5.53 0 0 1-5.52 5.52zm0-9a3.52 3.52 0 1 0 3.52 3.52 3.53 3.53 0 0 0-3.52-3.56z"/></g></g></svg>',document:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 82.71 114.32"><defs></defs><g id="Слой_2" data-name="Слой 2"><g id="Слой_1-2" data-name="Слой 1"><path d="M60 8.36H7.51A5.51 5.51 0 0 0 2 13.87v92.94a5.51 5.51 0 0 0 5.51 5.51H75.2a5.5 5.5 0 0 0 5.51-5.51V29.12z" class="callibriFilesFill"/><path class="callibriFilesBg" d="M75.2 114.32H7.51A7.52 7.52 0 0 1 0 106.81V13.87a7.52 7.52 0 0 1 7.51-7.51h53.28l21.92 21.93v78.52a7.52 7.52 0 0 1-7.51 7.51zM7.51 10.36A3.52 3.52 0 0 0 4 13.87v92.94a3.51 3.51 0 0 0 3.51 3.51H75.2a3.51 3.51 0 0 0 3.51-3.51V30L59.13 10.36z"/><path fill="#fff" d="M59.96 8.36v21.41h20.75L59.96 8.36z"/><path class="callibriFilesBg" d="M80.71 31.77H60a2 2 0 0 1-2-2V8.36A2 2 0 0 1 61.39 7l20.76 21.4a2 2 0 0 1-1.44 3.4zm-18.71-4h14L62 13.3zM21.72 48.06h-6.66a7.16 7.16 0 0 1-7.15-7.15V8.36A8.37 8.37 0 0 1 16.27 0H23a8.37 8.37 0 0 1 8.36 8.36 2 2 0 0 1-4 0A4.36 4.36 0 0 0 23 4h-6.73a4.37 4.37 0 0 0-4.36 4.36v32.55a3.16 3.16 0 0 0 3.15 3.15h6.66a3.16 3.16 0 0 0 3.15-3.15V22.12a3.16 3.16 0 1 0-6.31 0v14.8a2 2 0 0 1-4 0v-14.8a7.16 7.16 0 1 1 14.31 0v18.79a7.16 7.16 0 0 1-7.15 7.15zM62.12 55.82H13.35a2.12 2.12 0 0 1-2.11-2.11 2.12 2.12 0 0 1 2.11-2.11h48.77a2.09 2.09 0 0 1 1.48.61 2.12 2.12 0 0 1 .63 1.5 2.13 2.13 0 0 1-2.11 2.11zM62.12 63.46H13.35a2.08 2.08 0 0 1-1.49-.61 2.11 2.11 0 0 1-.62-1.49 2.12 2.12 0 0 1 2.11-2.11h48.77a2.12 2.12 0 0 1 2.11 2.11 2.1 2.1 0 0 1-2.11 2.1zM62.12 71.11H13.35a2.11 2.11 0 0 1-1.44-.56 2.13 2.13 0 0 1-.67-1.55 2.12 2.12 0 0 1 2.11-2.11h48.77a2.09 2.09 0 0 1 1.4.53 2.13 2.13 0 0 1 .71 1.58 2.13 2.13 0 0 1-.62 1.49 2.1 2.1 0 0 1-1.49.62zM62.12 78.76H13.35a2.05 2.05 0 0 1-1.49-.62 2.09 2.09 0 0 1-.62-1.48 2.16 2.16 0 0 1 .47-1.34 2.13 2.13 0 0 1 1.64-.77h48.77a2.11 2.11 0 0 1 1.48.6 2.17 2.17 0 0 1 .63 1.51 2.09 2.09 0 0 1-.57 1.43 2.11 2.11 0 0 1-1.54.67zM45.6 86.41H13.35a2.12 2.12 0 0 1-2.11-2.11 2.11 2.11 0 0 1 2.11-2.1H45.6a2.1 2.1 0 0 1 2.1 2.1 2.11 2.11 0 0 1-21 2.11z"/></g></g></svg>',clip:'<svg viewBox="0 0 9 16" xmlns="http://www.w3.org/2000/svg" class="callibri_settings_svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 0A4.5 4.5 0 0 0 .016 4.878.49.49 0 0 0 0 5v7.5a3.5 3.5 0 1 0 7 0V5.911 5.61c0-1.323-1.151-2.36-2.5-2.36A2.5 2.5 0 0 0 2 5.75v5.75a.5.5 0 0 0 1 0V5.689c0-.794.671-1.438 1.5-1.438.828 0 1.5.644 1.5 1.438V12.5a2.5 2.5 0 1 1-5 0V4.515A3.507 3.507 0 0 1 4.5 1C6.433 1 8 2.573 8 4.514V9.5a.5.5 0 0 0 1 0v-5A4.5 4.5 0 0 0 4.5 0zm4 11a.5.5 0 1 0 0 1 .5.5 0 0 0 0-1z" fill="#000"/></svg>',dnd:'<svg version="1" xmlns="http://www.w3.org/2000/svg" width="376" height="344" viewBox="0 0 282 258"><path d="M78.5 5.4L76 7.9V96c0 87.2 0 88 2 90 1.2 1.2 3.2 2.5 4.7 3.1 1.5.5 14.3.9 30.2.9h28.8c.8 0 1.3 2.1 1.5 5.7l.3 5.8 4.3.3 4.2.3V190l22.2.2c21.4.3 22.3.4 22.6 2.3.2 1.1.9 3.6 1.6 5.5.8 1.9 2.2 6.2 3.1 9.5 1 3.3 2.3 7.6 3 9.5.7 1.9 1.7 5 2.2 6.9.4 1.9 1.6 3.9 2.6 4.5 1.6.9 3.3-.4 12.2-9.7 5.7-5.9 11-10.7 11.7-10.7.8 0 6.1 4.9 11.8 11 5.8 6 11.2 11 12 11 2 0 21-19.1 21-21 0-.8-4.7-6.4-10.5-12.4S257 184.9 257 184c0-.9 4.5-6.3 10-12s10-10.9 10-11.7c0-1.5-1.7-2.3-10.5-4.8-3.3-1-7.8-2.3-10-3-2.2-.6-6.7-2-10-2.9-10.9-3.2-16-4.9-17.3-5.9-1.1-.8-1.3-10.7-1.2-50.1.2-31.6-.2-50-.8-51.6-.6-1.4-9.2-10.6-19.1-20.5L190 3.5l-54.5-.3L81 3l-2.5 2.4zm102.3 6.8c.8.8 1.2 6.8 1.2 20.3v19.2l2.5 1.1c1.6.8 8.4 1.2 17.8 1.2 10.6 0 15.7.4 16.5 1.2.9.9 1.2 11.9 1.2 43.5 0 36.3-.2 42.3-1.5 42.3-1.5 0-7.4-1.6-19-5-7.4-2.2-13.2-3.8-17.7-4.7-2.6-.5-2.8-.3-2.8 2.8.1 1.9.7 4.5 1.5 5.9.8 1.4 1.4 3.5 1.5 4.7 0 1.2.6 3.7 1.4 5.5.8 1.8 2.2 6 3.1 9.3 1 3.3 2.3 7.6 3 9.5 3.3 9.6 3.5 10.4 2.2 11.2-.6.4-24.6.8-53.2.8-39.2 0-52.4-.3-53.3-1.2-.9-.9-1.2-20.8-1.2-83.4 0-73.4.2-82.4 1.6-83.8 1.4-1.4 7.1-1.6 47.8-1.6 34.6 0 46.5.3 47.4 1.2zm21.7 21.9c5.5 5.7 9.3 10.4 8.8 10.7-.6.4-5.4.6-10.6.4l-9.5-.3-.4-9.2c-.4-9.3-.2-11.7 1.2-11.7.4 0 5.1 4.5 10.5 10.1z"/><path d="M101.4 71.4c-.3.8-.4 2.7-.2 4.3l.3 2.8h84l.3-2.8c.7-5.8 1.7-5.7-43-5.7-34.3 0-40.9.2-41.4 1.4zM101.8 88.1c-.5.3-.8 2.1-.6 4l.3 3.4 41.4.3c32.5.2 41.6 0 42.3-1 1.2-2 .9-5.8-.5-6.4-1.9-.7-81.7-1-82.9-.3zM101.4 105.4c-.3.8-.4 2.7-.2 4.3l.3 2.8h41.4c37.6 0 41.5-.2 42.4-1.7.8-1.2.8-2.4-.1-4.2L184 104h-41c-34.5 0-41.1.2-41.6 1.4zM101.4 122.4c-.3.8-.4 2.7-.2 4.3l.3 2.8h59v-8l-29.3-.3c-24.6-.2-29.3 0-29.8 1.2zM0 74.5v4.6l3.8-.3c3.6-.3 3.7-.4 3.7-4.3s-.1-4-3.7-4.3L0 69.9v4.6zM23.7 70.7c-.2.4-.7 1.9-1 3.3-1 4.3.3 5.1 7.9 4.8l6.9-.3v-8l-6.7-.3c-3.6-.2-6.8.1-7.1.5zM53.7 70.6c-.4.4-.7 2.5-.7 4.6V79h15.1l-.3-4.3-.3-4.2-6.5-.3c-3.6-.2-6.9 0-7.3.4zM0 101.5v7.5h8V94H0v7.5zM1.8 124.7c-1.5.4-1.8 1.6-1.8 7.8v7.3l3.1.7c4.2 1 5-.5 4.7-9-.3-7.4-1-8.2-6-6.8zM0 164v8.1l3.8-.3 3.7-.3v-15l-3.7-.3-3.8-.3v8.1zM0 194.4v7.6h8.1l-.3-7.3-.3-7.2-3.7-.3-3.8-.3v7.5zM2.7 217.8l-2.8.3.3 7.7.3 7.7h7l.3-7.1c.3-7.9-.5-9.2-5.1-8.6zM146.5 217.9c-2.9.6-3 .8-3.3 6.9-.4 7.5.8 9.4 5.2 9l3.1-.3.3-7.6c.3-8.4-.1-8.9-5.3-8zM.7 248.7c-.4.3-.7 2.1-.7 3.9 0 2.7.5 3.5 2.5 4 3.6.9 5.5-.2 5.5-3 0-4.1-1.1-5.6-3.9-5.6-1.5 0-3.1.3-3.4.7zM23 250.6c-.7 1.7-.7 3.2.1 4.5.9 1.7 1.9 2 7.1 1.7 6.8-.3 8.5-1.8 7.4-6.1-.6-2.6-.9-2.7-7.1-2.7-6.1 0-6.6.2-7.5 2.6zM53.4 249.4c-.3.8-.4 2.7-.2 4.3.3 2.8.4 2.8 7.3 2.8h7v-8l-6.8-.3c-5.2-.2-6.9 0-7.3 1.2zM83.6 249.6c-1.1 2.9-.6 6.2 1 6.8.9.3 4 .6 6.9.6 6.3 0 8.2-1.9 6.5-6.4-.9-2.4-1.4-2.6-7.4-2.6-4.9 0-6.5.4-7 1.6zM114 249.9c-2.5 4.7.3 7.1 8 7.1 5.5 0 7-.8 7-3.9 0-4-1.8-5.1-8.2-5.1-4.6 0-5.9.4-6.8 1.9zM144.8 249.1c-2.2 1.2-2.3 5.2-.4 6.8.8.7 2.7 1.1 4.3.9 2.5-.3 2.8-.7 2.8-4.3 0-3.5-.3-4-2.5-4.2-1.4-.2-3.3.2-4.2.8z"/></svg>'},b.clip=document.getElementById(b.options.clipId),b.dnd=document.getElementById(b.options.dndId),b.setChatInput(),b.is_mchat="undefined"!=typeof _callibri&&void 0!==_callibri.init,b.formats={image:"jpg|jpeg|png|gif|bmp|dwg|tiff|dxf|heic",table:"xlsx|xltx|xlt|xla|xls|xml",presentation:"pptx|potx|ppsx|pot|pps|ppt|ppa",document:"pdf|docx|doc|dotx|dot|gzip|zip|rar|txt"},b.sending=0,b.options.filesurl={},document.getElementById("CallibriFiles")||(b.initCss(),b.setOptionsUrl(document.location.protocol+"//wf.callibri.ru",b.options.session_id,b.options.site_id)),b.is_mchat?b.regexp=new RegExp("(http(s?):)([/W|\\S|-])*\\.(?:"+b.formats.image+"|"+b.formats.table+"|"+b.formats.presentation+"|"+b.formats.document+")","gi"):b.regexp=new RegExp("(http(s?):)([/W|\\S|-](?!http(s?)))*(\\.)("+b.formats.image+"|"+b.formats.table+"|"+b.formats.presentation+"|"+b.formats.document+")((\\?\\S*)?)","gi"),b.files=[],b.dnd&&innerHTML([b.dnd],b.dndHtml()),b.clip){if(b.clip.parentElement.appendChild(b.attachHtml()),b.is_mchat)innerHTML([b.clip],b.clipHtml()+b.listHtml());else{innerHTML([b.clip],b.clipHtmlCabinet());var c=document.body.querySelector(".container-for-attaches");innerHTML([c],b.listHtmlCabinet())}b.list_files=document.getElementById("callibri_container_list_files")}b.initEvents(),b.filesid=0},setChatInput:function(){var a=this;a.chatinput=document.getElementById(a.options.chatinput)||document.querySelector(a.options.chatinput)||null},initCss:function(a){var b=document.createElement("style"),c=this,d=c.is_mchat&&_callibri.internal_vars&&_callibri.internal_vars.main_color?_callibri.internal_vars.main_color:"#fac754",e=c.options.animation_dnd_speed,f=".callibriFilesBg{fill:#1e0e00;}.callibriFilesFill{fill:"+d+";}#"+c.options.dndId+'{display:none;}#callibri_chat_dnd_input{width:100%;height:100%;padding:0 18px;display: table;}#callibri_chat_dnd_main{width:100%;height:100%;text-align:center;border: 2px solid #d3d3d3;border-radius:11px;background-color:#fff;display: table-cell;vertical-align: middle;}#callibri_chat_dnd_image,#callibri_dnd_animation{width:94px;margin: 0 auto;}#callibri_chat_dnd_image svg,#callibri_dnd_animation svg{width: 100%;height: auto;}#callibri_chat_dnd_text{font-size: 16px;color:#000;}#callibri_canvas_img{display:none;}#callibri_notify_loading, #callibri_container_list_files {  position: absolute;  background-color: #f7f7f7;  max-width: 315px;  padding: 18px 30px 17px 17px;  z-index: 9;  white-space: normal;  word-break: break-word;  letter-spacing: 0px;  font-weight: 600;  -webkit-box-shadow: 0px 2px 7px 0px rgba(0,0,0,0.15);  -moz-box-shadow: 0px 2px 7px 0px rgba(0,0,0,0.15);  box-shadow: 0px 2px 7px 0px rgba(0,0,0,0.15);  width: max-content;  width: -moz-max-content;  top: -8px;  left: 18px;  -webkit-transform: translateY(-100%) translateX(-50%);  -ms-transform: translateY(-100%) translateX(-50%);  transform: translateY(-100%) translateX(-50%);  font-size: 12px !important;  line-height: 1.2;  color: #000;  border-radius: 10px;  text-align: left;}.callibri_triangle-block {  position: absolute;  bottom: -16px;  left: calc(50% - 16px);}.callibri_triangle-with-shadow {  width: 32px;  height: 16px;  position: relative;  overflow: hidden;}.callibri_triangle-with-shadow:after {  content: ""!important;  position: absolute;  width: 16px;  height: 16px;  background: #f7f7f7;  -webkit-transform: rotate(-45deg);  -ms-transform: rotate(-45deg);  transform: rotate(-45deg);  top: -8px;  left: 8px;  -webkit-box-shadow: 0px 0px 7px 0px rgba(0,0,0,0.15);  -moz-box-shadow: 0px 0px 7px 0px rgba(0,0,0,0.15);  box-shadow: 0px 0px 7px 0px rgba(0,0,0,0.15);}#callibri_container_list_files {  display: none;  background: #fff;  padding: 14px 6px 14px 6px;  cursor: default;  box-sizing: content-box;}.callibri_container_file {  display: inline-block;  vertical-align: top;  width: 90px;  margin: 0 5px;  position: relative;  text-align: center;  padding-top: 13px;}.callibri_svg_file_type {  margin: 0 auto 4px;  width: 30px;  position: relative;}.callibri_file_icon .callibri_svg_file_type {  margin: 0 auto 3px;  height: 58px;  width: 42px;  max-width: none;  position: relative;}.callibri_btn_remove_file {  position: absolute;  width: 14px;  height: 14px;  background: black;  border-radius: 50%;  top: 6px;  left: calc(50% + 15px);  cursor: pointer;}.callibri_btn_remove_file:after {  content: "" !important;  position: absolute;  top: 6px;  left: 3px;  background: #fff;  display: block;  width: 8px;  height: 2px;}.callibri_btn_remove_file:hover {  box-shadow: 0px 2px 2px 0px rgb(0,0,0,0.4);  -webkit-transform: scale(1.1);  -ms-transform: scale(1.1);  transform: scale(1.1);}.callibri_container_file p {  font-size: 6px;  font-weight: 400;}#message-form .callibri_container_file p {  font-size: 13px;  line-height: 1.4;  color: #1A1A1A;  margin: 0;  max-width: 138px;  text-align: left;  margin-right: 10px;  word-break: break-all;  max-height: 54px;  overflow: hidden;}.callibri_file_icon:hover .callibri_svg_file_type {  box-shadow: 0 2px 8px 0px rgba(0,0,0,0.26);  border-radius: 15px;  background: radial-gradient(circle, rgba(0,0,0,0.4), rgba(0,0,0,0) 100%);}.callibri_file_icon p {  font-size: 10px;  color: #262626;  margin: 0;}#callibri_container_list_files .callibri_triangle-with-shadow:after {  background: #fff;}#callibri_chat_clip.with_attach {  position: relative;}#callibri_chat_clip.with_attach:after {  content: attr(data-count-files) !important;  position: absolute;  display: block;  width: 14px;  height: 14px;  line-height: 13px;  background-color: #000;  color: #fff;  font-size: 12px;  top: -4px;  right: 4px;  border-radius: 50%;  text-align: center;  pointer-events: none;}#callibri_upload_file_chat {  height: 0px;  width: 0px;  position: absolute;  left: 0px;  top: 0px;  margin: 0;  padding: 0;  border: none;  display: none;}.callibri_size_from_content {  width: max-content;  width: -moz-max-content;  margin-left: auto;  max-width: 100%;}#callibri_dnd_animation{position:absolute;z-index:2147483647;transition:all '+e+"ms;}.callibri_files {justify-content: flex-end;}#callibri_appendHere .callibri_overflow.callibri_files.callibri_manager {flex-direction: row-reverse !important;}#callibri-module-area .callibri_files .callibri_chat_text_field_right, #callibri-module-area .callibri_files .callibri_chat_text_field{width:auto;max-width: -webkit-calc(100% - 96px);padding-bottom:12px;}#callibri_chat_clip.callibri_files_load:after{animation:pulsing 1.4s infinite;}@keyframes pulsing {0%,100%{opacity:1}50%{opacity:.2}}.callibri_file_icon{width: 86px;margin:0 5px;text-align:center;text-decoration:none !important;color: #262626 !important;}#message-form .container-for-attaches .callibri_container_file .callibri_svg_file_type .img-in-attach {max-height: 50px;}#"+c.options.submitBttnId+".inactive_btn { pointer-events: none; opacity: 0.7; }";b.setAttribute("id","CallibriFiles"),b.setAttribute("type","text/css"),b.appendChild(document.createTextNode(f)),document.getElementsByTagName("head")[0].appendChild(b)},initEvents:function(){var a=this;a.dnd&&a.dndEvents(),a.chatinput&&a.clipboardEvents(),a.clip&&a.clipEvents()},showClip:function(a){var b=this;b.clip&&(a=!(_callibri&&!a),b.show=a,b.clip.style.display=a?"block":"none")},setOptionsUrl:function(a,b,c){var d=this,e=d.options.filesurl;e.url=a||e.url,e.s=b||e.s,e.p=c||e.p},getFiles:function(a){var b=this;return!a||a>b.files.length-1?b.files:b.files[a]},checkType:function(a){var b=["image/jpg","image/jpeg","image/png","image/gif","text/plain","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/pdf","text/html","application/octet-stream","image/bmp","application/vnd.openxmlformats","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/zip","application/gzip","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.presentationml.slideshow","text/xml","application/x-rar-compressed","application/x-rar","image/vnd.dwg","image/tiff","image/vnd.dxf","application/x-ole-storage","image/heic","image/heic-sequence"],c=!1;return b.some(function(b){return a.match(b)?c=!0:b=!1,b}),c},getPreviewForImage:function(a){return'<div class="callibri_svg_file_type image"><img class="img-in-attach" src="'+a+'"></div>'},checkFile:function(a){var b=this;return!b.files.some(function(c){if(c.name==a.name&&c.size==a.size)return b.clip_open=!1,!0})&&(!!(a.size/1048576<5&&b.checkType(a.type))||void b.showError(a))},showError:function(a){var b=this,c="Размер файла должен быть",d=" меньше 5 мб",e="Формат загружаемого файла",f=" не поддерживается";b.checkLoc()&&(c=_callibri.localization.getText("files","size1"),d=_callibri.localization.getText("files","size2"),e=_callibri.localization.getText("files","format1"),f=_callibri.localization.getText("files","format2")),a.size/1048576>5&&b.clip.appendChild(b.notifyHtml(c,d)),b.checkType(a.type)||b.clip.appendChild(b.notifyHtml(e,f)),b.clip_open=!1},handleDelete:function(a){var b=this,c=a.target.parentElement.getAttribute("id").replace("callibri_file_","");b.deleteFile(c),b.is_mchat||(change_height_message_list(),init_button_file())},addImage:function(a){var b=this,c=document.getElementById("callibri_chat_clip"),d=document.getElementById(b.options.submitBttnId);c.classList.add("callibri_files_load"),d.classList.add("inactive_btn"),b.files.push(a),b.last_time_start_load=(new Date).value,b.sending--,b.list_files.insertAdjacentHTML("beforeend","<div class='callibri_container_file image-container' id='callibri_file_"+a.id+"'><div class='callibri_btn_remove_file'></div>"+b.getPreviewForImage(a.url)+"</div>"),Array.from(document.body.getElementsByClassName("callibri_btn_remove_file")).forEach(function(a){a.addEventListener("click",function(a){b.handleDelete(a)},!1)}),init_button_file(),b.list_files.style.display="block",b.sending++,b.showCounter()},addFile:function(a){var b=this;if(b.checkFile(a)&&b.list_files){a.id=b.filesid,b.filesid++;var c=a.name;b.files.push(a);var d=document.getElementById("callibri_chat_clip"),e=document.getElementById(b.options.submitBttnId);b.last_time_start_load=(new Date).value,d.classList.add("callibri_files_load"),e.classList.add("inactive_btn");var f=new File([a],b.newName(c),{type:a.type});if(b.is_mchat){a.url?setTimeout(function(){b.sending--,b.showCounter()},1):b.sendFiles(f).then(function(d){d?(filesurl=b.options.filesurl,a.url=(filesurl.url+"/files/"+d+"?s="+filesurl.s+"&p="+filesurl.p+"&originalname="+c).replace(/(\s|\n)+/g,"")):b.deleteFile(a.id),b.sending--,b.showCounter()}).catch(function(c){console.error("There was an error:",c.statusText),b.deleteFile(a.id),b.sending--,b.showCounter()}),b.list_files.insertAdjacentHTML("beforeend","<div class='callibri_container_file' id='callibri_file_"+a.id+"'><div class='callibri_btn_remove_file'></div>"+b.drawIcon(c)+"</div>");Array.from(document.body.getElementsByClassName("callibri_btn_remove_file")).forEach(function(a){a.addEventListener("click",function(a){b.is_mchat?b.deleteFiles(a):b.handleDelete(a)},!1)}),b.showCounter(),b.sending++}else a.url?setTimeout(function(){b.sending--,b.showCounter()},1):b.sendFiles(f).then(function(d){d?(filesurl=b.options.filesurl,a.url=(filesurl.url+"/files/"+d+"?s="+filesurl.s+"&p="+filesurl.p+"&size="+a.size+"&originalname="+c).replace(/(\s|\n)+/g,"")):b.deleteFile(a.id),b.sending--}).then(function(){var d=b.checkForImage(a.url),e=d?"image-container":"",f=d?b.getPreviewForImage(a.url):b.drawDefaultIcon(c,null,a.size);b.list_files.insertAdjacentHTML("beforeend","<div class='callibri_container_file "+e+"' id='callibri_file_"+a.id+"'><div class='callibri_btn_remove_file'></div>"+f+"</div>"),Array.from(document.body.getElementsByClassName("callibri_btn_remove_file")).forEach(function(a){a.addEventListener("click",function(a){b.handleDelete(a)},!1)}),init_button_file(),b.list_files.style.display="block",b.sending++}).catch(function(c){console.error("err:",c),console.error("There was an error:",c.statusText),b.deleteFile(a.id),b.sending--}).finally(function(){messageSendingBlock&&messageSendingBlock.updateAttachsCounter(b.files.length),b.showCounter(),change_height_message_list()})}},getTypeFromUrl:function(a){var b=this,c=b.getOriginalName(a);return c.slice((Math.max(0,c.lastIndexOf("."))||1/0)+1)},checkForImage:function(a){var b=this;return null!==b.getTypeFromUrl(a).match(new RegExp("("+b.formats.image+")"),"g")},getFile:function(a){return this.files.find(function(b){return b.id==a&&b})},cute_name:function(a,b){b=b||8;var c=a,d=c.lastIndexOf(".");return-1!=d&&(c=c.length-c.substr(d).length-1>b?c.slice(0,b).replace(" ","_")+"..."+c.substr(d-1):c.replace(" ","_")),c},deleteFile:function(a){var b=this;b.files.some(function(c,d){c.id==a&&b.files.splice(d,1)}),document.getElementById("callibri_file_"+a).remove(),b.showCounter(),0===b.files.length&&b.list_files&&(b.list_files.style.display="none",b.is_mchat||messageSendingBlock.updateAttachsCounter(b.files.length))},getOriginalName:function(a,b){try{var c=new URL(a).searchParams.get("originalname");return c||(b?a.replace(/<\/div>/,"").split("/").pop().split("#")[0].split("?")[0]:a.split("/").pop().split("#")[0].split("?")[0])}catch(b){return a}},getSize:function(a,b){try{var c=new URL(a).searchParams.get("size");return c||a.replace(/<\/div>/,"").split("/").pop().split("#")[0].split("?")[0]}catch(b){return a}},getOriginalType:function(a){var b=this,c=["image/jpg","image/jpeg","image/png","image/gif","text/plain","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/pdf","text/html","application/octet-stream","image/bmp","application/vnd.openxmlformats","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/zip","application/gzip","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.presentationml.slideshow","text/xml","application/x-rar-compressed","application/x-rar","image/vnd.dwg","image/tiff","image/vnd.dxf","application/x-ole-storage","image/heic","image/heic-sequence"],d=b.getTypeFromUrl(a),e="";return c.some(function(a){-1!==a.split("/")[1].indexOf(d)&&(e=a)}),e},deleteFiles:function(){var a=this;a.files=[],a.list_files&&(innerHTML([a.list_files],a.is_mchat?"<div class='callibri_triangle-block'><div class='callibri_triangle-with-shadow'></div></div>":""),0===a.files.length&&(a.list_files.style.display="none"),a.showCounter())},drawIcon:function(a,b){a=a.replace(/&amp;/g,"&");var c=this,d=c.getOriginalName(a),e=d.slice((Math.max(0,d.lastIndexOf("."))||1/0)+1);return b||(b=e.match(new RegExp("("+c.formats.image+")"),"g")?"image":e.match(new RegExp("("+c.formats.table+")"),"g")?"table":e.match(new RegExp("("+c.formats.presentation+")"),"g")?"presentation":"document"),"<div class='callibri_svg_file_type'>"+c.svg[b]+"</div><p style='font-size: 10px !important;'>"+c.cute_name(d)+"</p>"},drawDefaultIcon:function(a,b){a=a.replace(/&amp;/g,"&");var c=this,d=c.getOriginalName(a),e=d.slice((Math.max(0,d.lastIndexOf("."))||1/0)+1);return b||(e.match(new RegExp("("+c.formats.image+")"),"g")?b="image":(b="document",c.svg.document='<div class="document_svg"></div>')),"<div class='callibri_svg_file_type'>"+c.svg[b]+"</div><p>"+d+"</p>"},drawIconCabinet:function(a,b,c){function d(a){if(0===a)return"";var b=a/Math.pow(10,6),c=Number(b.toFixed(3));return c<=.05?c*Math.pow(10,3)+" Кб":c.toFixed(1)+" Мб"}a=a.replace(/&amp;/g,"&");var e=this,f=e.getOriginalName(a),g=f.slice((Math.max(0,f.lastIndexOf("."))||1/0)+1);b||(g.match(new RegExp("("+e.formats.image+")"),"g")?b="image":(b="document",e.svg.document='<div class="document_svg"></div>'));var h=c||function(a){var b=a.match(/size=\d{1,}/g),c=null===b?"":b[0],e=c.substring(5);return d(Number(e))}(a);if("image"===b){if(!e.is_mchat)return;var i=new URL(a);"http://wf.callibri.ru"===i.origin&&i.pathname.includes("/files/")&&(a+="&edna_wa=true")}return'<div class="callibri_svg_file_type">'+e.svg[b]+'</div><div class="attach-text-container"><span class="name-file">'+f+'</span><span class="size">'+h+'</span></div><span class="download-btn"></span>'},attachHtml:function(){var a=document.createElement("input");return a.id="callibri_upload_file_chat",a.name="file",a.title="attach",a.type="file",a.setAttribute("multiple",""),a},clipHtml:function(){return"<div id='callibri_chat_clip_image' class='callibri_chat_icons'>"+this.svg.clip+"</div>"},clipHtmlCabinet:function(){return this.is_mchat?"<div id='callibri_chat_clip_image' class='callibri_chat_icons add_help_text' data-full-text='Прикрепить файл' data-aligning-help='center-up'></div>":"<div id='callibri_chat_clip_image' class='callibri_chat_icons help-text top-position-sending-block' data-title='Прикрепить файл'></div>"},clipEvents:function(){function a(){for(var a=this.files,b=0;b<a.length;b++){var d=a[b];c.checkFile(d)?c.addFile(d):c.files.some(function(a){a.name!=d.name||a.size!=d.size||c.is_mchat||"function"!=typeof append_errors2||append_errors2(["Этот фаил уже добавлен"])})}c.is_mchat||init_button_file()}function b(a){a.preventDefault(),a.stopPropagation()}var c=this,d=c.clip;if(c.is_mchat){d.addEventListener("click",function(a){null!==document.getElementById("callibri_notify_loading")&&document.getElementById("callibri_notify_loading").remove(),document.getElementById("callibri_upload_file_chat").click()}),c.list_files&&(d.addEventListener("mouseenter",function(a){c.getFiles().length>0&&(c.list_files.style.display="block")}),d.addEventListener("mouseleave",function(a){c.list_files.style.display="none"}),c.list_files.addEventListener("click",function(a){b(a)}));var e=document.getElementById("callibri_upload_file_chat");e.addEventListener("change",a,!1)}else{var e=document.getElementById("callibri_upload_file_chat");d.addEventListener("click",function(a){var b=document.getElementById("callibri_notify_loading");if(null!==b)return b.remove();e.click()}),e.addEventListener("click",function(a){a.target.value=""},!1),e.addEventListener("change",a,!1)}},checkLoc:function(){return this.is_mchat&&_callibri.localization},dndHtml:function(){var a,b=this;return a=b.is_mchat?b.checkLoc()?_callibri.localization.getText("files","dnd"):"Переместите файл сюда":b.checkLoc()?_callibri.localization.getText("files","dnd"):"Переместите <br>файл в окно",dnd="<div id='callibri_chat_dnd_input'><div id='callibri_chat_dnd_main'><div id='callibri_chat_dnd_image'>"+b.svg.dnd+"</div><div id='callibri_chat_dnd_text'>"+a+"</div></div></div>",dnd},dndEvents:function(){function a(a){a.preventDefault(),a.stopPropagation()}function b(b){d.is_mchat?d.show?(d.dnd.style.height=document.getElementById("callibri_group_name")?"calc(100% - 75px)":"calc(100% - 39px)",d.dnd.style.display="block"):a(b):d.dnd.style.display="block"}function c(a){function b(b){var c=!1;return(a.path||a.composedPath&&a.composedPath()).some(function(a){if(a.id&&"function"==typeof a.id.match&&a.id.match(b))return c=!0,!0}),c}a&&(a.target.id&&b("callibri")||b("second-column-portlet-body"))||(d.dnd.style.display="none")}var d=this,e=d.dnd;["dragenter","dragover","dragleave"].forEach(function(b){e.addEventListener(b,a,!1)});var f=d.is_mchat?document:document.getElementById("chat-main-wrapper");["dragenter","dragover"].forEach(function(a){f.addEventListener(a,b,!1)}),f.addEventListener("dragleave",c,!1),e.addEventListener("drop",function(a){a.stopPropagation(),a.preventDefault();var b=a.dataTransfer.files,e=document.querySelector("#callibri_chat_dnd_image");d.animation_dnd_position=e.getClientRects()[0];for(var f=0;f<b.length;f++){b[f];!function(a){var b=new FileReader;b.onload=function(b){d.addFile(a),d.animationAfterDrop()},d.checkFile(a)&&b.readAsDataURL(a)}(b[f])}c()})},animationAfterDrop:function(){var a=this,b=document.querySelector("#callibri_chat_clip_image"),c=document.querySelector("#callibri_dnd_animation");if(a.animation_dnd_position&&b&&!c){var d=document.createElement("div")
;d.setAttribute("id","callibri_dnd_animation"),d.setAttribute("style","top:"+(Number(a.animation_dnd_position.top)+20)+"px;left:"+a.animation_dnd_position.left+"px;"),document.getElementsByTagName("body")[0].appendChild(d),innerHTML([d],a.svg.dnd),setTimeout(function(){d.setAttribute("style","top:"+Number(b.getBoundingClientRect().top)+"px;left:"+(Number(b.getBoundingClientRect().left)-70)+"px;opacity:0;transform:scale(0);")},1),setTimeout(function(){d.parentNode.removeChild(d)},a.options.animation_dnd_speed+1)}},sendFiles:function(a){var b=this,c=new FormData;return c.append(a.name,a),new Promise(function(a,d){var e=new XMLHttpRequest,f=b.options.filesurl,g=f.url+"/upload?s="+f.s+"&p="+f.p,h=document.querySelector('meta[name="referrer"]');h&&h.content&&["strict-origin-when-cross-origin"].indexOf(h.content)>-1||(g+="&referer="+encodeURIComponent(document.location.href)),e.open("POST",g,!0),e.onload=function(){4===this.readyState&&this.status>=200&&this.status<300?a(e.response):d({status:this.status,statusText:e.statusText})},e.onerror=function(){d({status:this.status,statusText:e.statusText})},e.send(c)})},clearText:function(a){a=CallibriGetTextProcessing(a),a=a.replace(/&amp;/g,"&");var b=this,c=b.regexp,d=new RegExp("(http(s?):)([/|.|\\W|\\S|-])*\\.(?:"+b.formats.image+")((\\?\\S*)?)","g"),e=a.match(c),f={images:[],documents:[],text:a};if(null!==e){var g=[];e.forEach(function(a){var b=a.replace(/&size=.[^"|\s]*/g,"").replace(/&originalname=.[^"|\s]*/g,"").replace(/&edna_wa=true.[^"|\s]*/g,"");if(!g.includes(b)){var c=a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),d=new RegExp(c,"g"),e=f.text.replace(d,""),h=e.replace("<div>","").replace("</div>","").trim();f.text=0===h.length?"":e,g=g.concat(a.split(" "))}}),g.forEach(function(a){if(a.match(d)){if(f.images.includes(a))return;f.images.push(a)}else if(a.match(c)){if(f.documents.includes(a))return;f.documents.push(a)}else f.text+=a})}return f.text=f.text.replace(/(?:&amp;size=\d*)/gi,""),f.text.trim(),f},sendMessage:function(a,b){var c=this,d=c.regexp,e=CallibriGetTextProcessing(a.text),f="",g=/(<a[-A-Zа-яА-Я0-9+&@#\/%?*$=~_|!:,.;>\s\\"{}]*)?<figure.*?<\/figure>(<\/a>)?/gi;if(c.files.length>0&&0===c.sending&&!b&&c.files.forEach(function(a){e+=" "+a.url}),!e.match(d))return e;e=e.replace(g,function(a){return a.replace(/([^href=\\"]|^)(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?*$=~_\[\]\{\}|!:,.;]*[-A-Z0-9+&@#\/%*$=~_\[\]\{\}|])/gi,"$1")});var h=new RegExp('<img src="https?://'+_callibri.server_host+'/emoji/img/blank.gif".*?alt="(.*?)">',"g");e=e.replace(h,function(a){return a.replace("<","&#60;").replace(">","&#62;")});var i=c.clearText(e),j=i.images,k=i.documents;return f=i.text.replace("&#60;","<").replace("&#62;",">"),b||(k.forEach(function(a){-1==f.indexOf(a)&&(f+=" "+a)}),j.forEach(function(a){-1==f.indexOf(a)&&(f+=" "+a)})),f},drawMessage:function(a){function b(a,b,d){function e(b,e,f){var g='<div class="'+("callibri_client"==b?"callibri_chat_text_field_right":"callibri_chat_text_field")+'" ><div class="callibri_msg_block" data-msg-index="'+callibri_current_msg_count+'" data-is-user-msg="'+j+'" data-callibri_unread="true">'+f+"</div></div>",h=a.last_history_operator?a.last_history_operator:_callibri.chat_operator;me="я",c.checkLoc()&&(h=_callibri.localization.translitOperator(h),_callibri.localization.getText("chat","avatar"));var l="<div class='callibri_chatPict'>"+(e?"callibri_client"==b?"<div class='callibri_chat_pict_user callibri_bttn_color'>"+me+"</div>":"<img class='callibri_chat_pict' src='"+h.avatar_image+"' onmouseover='callibri_operator_name_over(event,\""+h.name+"\")' onmouseout='callibri_operator_name_out()'><div class='callibri_online'></div><div class='callibri_time'>"+i+"</div>":"")+"</div>";return"<div class='callibri_overflow "+(d?"":"callibri_files ")+"callibri_chat_message "+b+"'"+k+">"+g+l+"</div>"}var f=document.getElementsByClassName("callibri_chat_message"),g=(a.avatar_image&&a.avatar_image,a.has_manager?"callibri_manager":"callibri_client"),h=a.datetime||a.created_at||void 0;h="Invalid Date"===new Date(h)||isNaN(new Date(h))?h:new Date(h);var i=h.toLocaleString("ru",{hour:"numeric",minute:"numeric"}),j="user"==a.author,k=callibriMessageCreatedAt(a);if(f.length>0){var l=f[f.length-1];return l.classList.contains("callibri_client")&&"callibri_client"==g?e("callibri_client",!1,b):l.classList.contains("callibri_manager")&&"callibri_manager"==g?e("callibri_manager",!1,b):e(g,!0,b)}return e(g,!0,b)}var c=this,d=document.getElementById("callibri_appendHere"),e=a.text;e=e.replace(/<div>/g,"").replace(/<\/div>/g,"");var f=c.clearText(e),g=f.images,h=f.documents;f.text=f.text.trim();var i=f.text.replace(/<\/?[^>]+(>|$)/g,"").trim();if(i.length>0&&i.replace(/ +/g,"").length>0&&d.insertAdjacentHTML("beforeend",b(a,CallibriGetTextProcessing(f.text,c.is_mchat),!0)),h.length>0){var j="";h.forEach(function(b){j+='<a href="'+b+'" target="_blank" rel="noopener noreferrer" class="callibri_file_icon" style="float:'+(a.has_manager?"left":"right")+';">'+c.drawIcon(b)+"</a>"}),d.innerHTML+=b(a,j)}g.length>0&&g.forEach(function(c){var e='<img class="callibri_image_preview callibri_gif" onclick="callibri_show_original_image(event, this)" src="'+c+'">';d.innerHTML+=b(a,e)});var k=document.querySelectorAll(".callibri_msg_block"),l=k[k.length-1];a.has_manager&&_callibri.websocket_service&&setTimeout(function(){_callibri.websocket_service.trigger("message_delivered",{id:a.id,random_id:a.random_id})},100),CallibriChatWidget.prototype.msg_top(l)},drawMessageCabinet:function(a){function b(a){var b=/(\b(https?|ftp|file):\/\/([^:\/\s]+)[-а-яА-ЯA-Z0-9+&@#\/%?=~_\[\]\{\}|!:,.;]*[-а-яА-ЯA-Z0-9+&@#\/%=~_\[\]\{\}|])/gi,c=0,d=[];return a=a.replace(b,function(a){var b="callibri_replace_text_and_link_var_"+c;return d.push(a),c++,b}),[a,d]}function c(a){var c=b(a),d=c[0].replace(/([\w|\-|_|.]+@\w+.\w{0,3})/g,'<a class="text-link mail-phone">$1</a>').replace(/(\b(\+|\s|\/d)?(\(\d{2,3}\) ?\d|\d)(([ \-]?\d)|( ?\(\d{2,3}\) ?)){5,12}\d)/g,'<a class="text-link mail-phone">$1</a>'),e=document.createElement("div");return c[1].forEach(function(a,b){d=d.replace("callibri_replace_text_and_link_var_"+b,a)}),e.id="check_text_div",e.style.display="none",innerHTML([e],d),e.innerText.trim()||(d=""),e.remove(),d}var d=this,e=a.text,f=a.incoming?"in":"out";a.id;e=e.replace(/<div>/g,"").replace(/<\/div>/g,""),e=StickerProcessing(e,a.transport);var g=d.clearText(e),h=g.images,i=g.documents,j=[];return i.length>0&&i.forEach(function(a){j.push('<a href="'+d.format_url(a)+'" target="_blank" rel="noopener noreferrer" class="callibri_file_icon">'+d.drawIconCabinet(a)+"</a>")}),h.length>0&&h.forEach(function(b){var c="instagram"===a.transport||"vk"===a.transport||"viber"===a.transport?b:d.format_url(b);j.push('<a href="'+c+'" class="img-block fancybox" rel="gallery"><img class="link-to-img" src="'+c+'"></a>')}),function(a,b,d,e){var f=a.datetime||a.created_at||void 0,g="Invalid Date"===new Date(f)||isNaN(new Date(f))?f:new Date(f),h=g.toLocaleString("ru",{hour:"numeric",minute:"numeric"}),i=e.sendMessage(a,!0),j=null!==i.replace(/<\/?[a-z]{0,}>/g,"").trim().match(new RegExp(/\S/g)),k=j&&b,l=mapTransportNames[a.transport]||"",m=getAvatarElement(a);"site"==l&&owner&&owner.length>0&&(l=owner[0].toUpperCase()+owner.slice(1));var n=a.id||a.random_id?'data-msg-id="'+(a.id||a.random_id)+'"':"";message='<div class="message callibri_size_from_content"><span class="body">'+b+'</span><div class="info">'+'<span class="name">{0}</span>'.format(a.author_name)+'<span class="datetime text-muted">'+h+"</span>"+'<span class="incoming-from messenger-icon-{0} help-text top-position" data-title="{1}"></span>'.format(a.transport,l)+"</div></div>";var o='<li class="{0} {1}" data-disable-contextmenu="true" {2}>'.format(d,k?"start-many-mssg":"",n)+m+'<div class="message"><span class="body">'+(c(i)?c(i):b||"")+'</span><div class="info">'+'<span class="name">{0}</span>'.format(a.author_name)+'<span class="datetime text-muted">'+h+"</span>"+'<span class="incoming-from messenger-icon-{0} help-text top-position" data-title="{1}"></span>'.format(a.transport,l)+"</div></div></li>",p='<li class="'+d+(k?" many_mssg":"")+'" data-disable-contextmenu=true '+n+">"+m+message+"</li>",q="";return c(i)&&b?q=o+p:c(i)?q=o:b&&(q=p),q}(a,j.join(""),f,d)},newName:function(a){a="undefined"!=typeof _callibri&&_callibri.localization?_callibri.localization.translit(a):"function"==typeof callibriTranslit?callibriTranslit(a):a,a=a.replace(/ /g,"_");var b=a.slice(Math.max(0,a.lastIndexOf("."))||1/0),c=a.substring(0,a.length-b.length);return c.length>110&&(c=c.slice(0,110),a=c+b),a},clipboardEvents:function(){function a(){var a=g.value,b=document.createElement("div");innerHTML([b],a),Array.from(b.children).forEach(function(a){var b=!!a.querySelector("figure"),c=1===a.childNodes.length&&"BR"===a.firstChild.tagName;(b||c)&&a.remove()}),g.value=b.outerHTML}function b(a){var b=g.editor?g.editor.getDocument().toString():g.textContent,c=b.indexOf(a),d=c+a.length;c<0||(g.editor.setSelectedRange([c,d]),g.editor.deleteInDirection("backward"))}function c(a){var b=new File([],f.getOriginalName(a),{type:"image/png"});return b.url=a,b.id=b.lastModified,f.is_mchat?f.addFile(b):f.addImage(b)}function d(a){if(a&&f.checkFile(a)){var b=a.name.slice(Math.max(0,a.name.lastIndexOf("."))||1/0),c=f.newName(a.name.substring(0,a.name.length-b.length))+"_"+(new Date).getTime()+b,d=a.slice(0,a.size,a.type);a=new File([d],c,{type:a.type}),a.clipboard=!0,f.addFile(a)}}function e(e){var h=e.clipboardData||window.clipboardData||e.originalEvent.clipboardData;if(h&&0!==h.items.length){var i=h.getData("text/html")||h.getData("Text")||g.value,j=i&&0!==i.length?f.clearText(i).images:[],k=0!==h.files.length?Array.from(h.files):[];if(f.is_mchat){if(i){var l=i.replace(/(<([^>]+)>)/gi,"");g.value=l;var m=window.getSelection(),n=document.createTextNode(l);g.innerHTML&&m.rangeCount?(m.deleteFromDocument(),m.getRangeAt(0).insertNode(n)):innerHTML([g],l)}return k.length>0?Array.prototype.forEach.call(h.items,function(a,b){var c=a.getAsFile();if(c&&f.checkFile(c)){var d=c.name.slice(Math.max(0,c.name.lastIndexOf("."))||1/0),g=f.newName(c.name.substring(0,c.name.length-d.length))+"_"+(new Date).getTime()+d,h=c.slice(0,c.size,c.type);c=new File([h],g,{type:c.type}),c.clipboard=!0,f.addFile(c),e.preventDefault(),e.stopPropagation()}}):j.forEach(c),g.blur(),i&&setTimeout(function(){g.value=i.replace(/(<([^>]+)>)/gi,"");var a=window.getSelection();g.innerHTML&&a.rangeCount?(a.deleteFromDocument(),a.getRangeAt(0).insertNode(document.createTextNode(i.replace(/(<([^>]+)>)/gi,"")))):innerHTML([g],f.clearText(i).text),g.focus()},1),!1}a(),k.length>0?(Array.from(h.items).forEach(function(a){return a.getAsString(b)}),k.forEach(d)):j.length>0&&(j.forEach(b),j.forEach(c)),e.preventDefault(),e.stopPropagation();var o=g.editor.getDocument().toString();return g.editor.setSelectedRange(o.length-1),!1}}var f=this,g=f.chatinput;f.options.chatinput&&g&&g.addEventListener("paste",e)},notifyHtml:function(a,b){var c=document.createElement("div"),d=document.createElement("b"),e=document.createElement("div"),f=document.createElement("div");return c.id="callibri_notify_loading",c.innerText=a,c.appendChild(document.createElement("br")),d.innerText=b,c.appendChild(d),e.className="callibri_triangle-block",f.className="callibri_triangle-with-shadow",e.appendChild(f),c.appendChild(e),c},listHtml:function(){return"<div id='callibri_container_list_files'><div class='callibri_triangle-block'><div class='callibri_triangle-with-shadow'></div></div></div>"},listHtmlCabinet:function(){return"<div class='pagination_list_files'><div id='file-left-bottom' data-file-scroll-bottom='left' onclick='move_file(this)' style='display: none;'></div><div id='callibri_container_list_files' onscroll='hiding_button()' data-file-scroll-bottom='right' style='display: none;'></div><div id='file-right-bottom' onclick='move_file(this)'></div></div>"},showCounter:function(){var a=this,b=a.clip;if(a.is_mchat&&(a.files.length>0?b.classList.add("with_attach"):b.classList.remove("with_attach")),b.setAttribute("data-count-files",a.files.length),0===a.sending){var c=document.getElementById("callibri_chat_clip"),d=document.getElementById(a.options.submitBttnId),e=5e3;if(a.last_time_start_load){var f=(new Date).value-a.last_time_start_load;e=f<5e3?f-5e3:0}setTimeout(function(){c.classList.remove("callibri_files_load")},e),d.classList.remove("inactive_btn")}a.clip_open=!1},format_url:function(a){return a=a.replace(/&amp;/g,"&").split("?"),a[0]+="?",a[1]&&a[1].split("&").forEach(function(b){b=b.split("="),"p"!==b[0]&&"s"!==b[0]||(a[0]+=b.join("=")+"&")}),self.is_mchat?a[0].slice(0,-1):a.join("")}};